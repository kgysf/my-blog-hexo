<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="renderer" content="webkit"><meta name="theme-color" content="#FFFFFF"><title>迁移Hexo+Action自动部署时遇到的问题记录 | Xianyu's Note</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="stylesheet" href="/css/heti-reset.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Xianyu's Note" type="application/atom+xml">
</head><body>
<script src="/js/axianyu.js"></script>
<div class="header"><a class="home-link" href="/"><span>Home</span></a><span class="header-center"></span><a class="email-link" href="mailto:master@uynex.com?subject=[Comment] About: 迁移Hexo+Action自动部署时遇到的问题记录&amp;body=请在此处书写您的邮件内容; 请勿修改标题, 否则您的邮件可能会被收信规则屏蔽%0d%0a%0d%0a--------------------%0d%0aTitle: 迁移Hexo+Action自动部署时遇到的问题记录%0d%0aUrl: http://blog.uremy.world/2022/01/hexo-action-deploy/index.html%0d%0a"><span>Email</span></a><a class="about-link" href="/2022/01/about/"><span>About</span></a></div><div class="content heti1"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">迁移Hexo+Action自动部署时遇到的问题记录</p></h2><div class="post-info"><span><time datetime="2022-01-06T11:22:38.000Z">2022-01-06</time></span><span class="header-center"></span><span class="license"><a href="#license">CC BY-NC-SA</a></span></div><div class="post-content"><p>头两天整了下服务器环境装点东西, 很久没折腾个人网站了, 以前用的是typecho用了几年, 后来越来越懒的折腾了, 导致服务器环境很多东西都忘了, 一下升级openssl给把PHP环境整炸了; 于是干脆迁移hexo了, 选了少部分文章迁移过来(其实就是迁移着就懒得迁移了, 加上以前很多文章并非纯markdown, 更加懒得修改了)。</p>
<p>其实最开始也用过一段时间hexo, 但是当年整hexo太麻烦了, 被我放弃了选择了typecho; 现在有了GitHub Action, 方便很多了, 于是折腾了下action自动部署hexo, 记录下折腾过程中遇到的一些问题.</p>
<h3 id="Permission-denied-publickey-错误"><a href="#Permission-denied-publickey-错误" class="headerlink" title="Permission denied (publickey) 错误"></a>Permission denied (publickey) 错误</h3><p>Action部署时出现如下错误:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Warning: Permanently added the ECDSA host key for IP address &#x27;140.82.114.4&#x27; to the list of known hosts.</span><br><span class="line">Load key &quot;/home/runner/.ssh/id_rsa&quot;: invalid format</span><br><span class="line">git@github.com: Permission denied (publickey).</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre></td></tr></table></figure>

<p>Action的配置自然是谷歌上搜索来的, 大部分的action配置都差不多, 都会有一段类似:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">    <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY&#125;&#125;</span></span><br><span class="line"><span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    sudo timedatectl set-timezone &quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="string">    mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">    echo &quot;$HEXO_DEPLOY_PRI&quot; &gt; ~/.ssh/id_rsa</span></span><br></pre></td></tr></table></figure>
<p>的配置, 这段配置是将仓库设置里设置的 <code>secrets</code> 读取到环境变量 <code>HEXO_DEPLOY_PRI</code> 中, 然后执行后面的脚本将 <code>HEXO_DEPLOY_PRI</code> 保存到系统的 <code>id_rsa</code> 里, 如果完全按照往上的教程来, 包括 <code>secrets</code> 的名字也都一样的话, 这里一般不会出现问题, 但是我这里名字是我自己取的, 导致没有action没能成功读取到 <code>secrets</code> , 只要将</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">    <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>中的 <code>secrets.HEXO_DEPLOY</code> 改成  <code>secrets.你自己取的名字</code> 即可</p>
<h3 id="Checkout-deploy-repo-出错"><a href="#Checkout-deploy-repo-出错" class="headerlink" title="Checkout deploy repo 出错"></a>Checkout deploy repo 出错</h3><p>在Checkout deploy repo过程中出错的话, 检查下 <code>_config.yml</code> 中 <code>deploy</code> 部分是否配置正确, <code>_config.yml</code> 中 <code>deploy</code> 的 <code>branch</code> 应该要与 Action 配置中的 <code>DEPLOY_BRANCH</code> 一致, <code>_config.yml</code> 中 <code>deploy</code> 的 <code>branch</code> 默认为 <code>gh-pages</code>, 大部分 Action 的配置中 <code>DEPLOY_BRANCH</code> 的值一般都是 <code>master</code>.</p>
</div><div class="post-tags"><h3>Tags</h3><i><a href="/tags/Hexo">#Hexo</a></i></div><a name="license"></a><div class="cc-license"> <div class="cc-post-title">迁移Hexo+Action自动部署时遇到的问题记录</div><div class="cc-post-url"><a href="http://blog.uremy.world/2022/01/hexo-action-deploy/">http://blog.uremy.world/2022/01/hexo-action-deploy/</a></div><div class="cc-post-detail"> <span class="cc-post-detail-item cc-post-detail-author"><div class="cc-post-detail-item-title"> 本文作者</div><div class="cc-post-detail-item-value">咸鱼</div></span><span class="cc-post-detail-item cc-post-detail-date"><div class="cc-post-detail-item-title"> 发布时间</div><div class="cc-post-detail-item-value">2022-01-06</div></span><span class="cc-post-detail-item cc-post-detail-license"><div class="cc-post-detail-item-title"> 许可协议</div><div class="cc-post-detail-item-value"><a class="cc-license-name" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a></div></span></div><div class="cc-post-desc">本文采用 [CC 署名-非商业性使用-相同方式共享 4.0] 协议, 转载或引用本文时请遵守许可协议!</div></div><script>var postInfo = { 
    license: 'CC BY-NC-SA 4.0',
    author: '咸鱼',
    url: 'http://blog.uremy.world/2022/01/hexo-action-deploy/',
}</script><div id="pagination"><div class="post-pagination"><div class="prev-post pull-left"><div class="post-pageurl"><a href="/2022/01/leetcode-bfs-note/"><span>Leetcode BFS相关题目笔记</span></a></div></div><div class="next-post pull-right"><div class="post-pageurl"><a href="/2022/01/change-active-openxr-runtime/"><span>Windows 将 OpenXR Runtime 修改回 SteamVR</span></a></div></div></div></div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/kgysf/hexo-theme-axianyu">Axianyu</a> , Powered By Hexo.</div></div>
<script src="/js/heti-addon.min.js"></script>
<script>const heti = new Heti('.heti1');
heti.autoSpacing();</script></body></html>