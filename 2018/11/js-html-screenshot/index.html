<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="renderer" content="webkit"><meta name="theme-color" content="#FFFFFF"><title>JS原生实现HTML元素截图</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Xianyu's Note" type="application/atom+xml">
</head><body><div class="header"><a class="email-link" href="/"><span>Home</span></a><span class="header-center"></span><a class="email-link" href="mailto:master@uynex.com?subject=[Comment] About: JS原生实现HTML元素截图&amp;body=请在此处书写您的邮件内容; 请勿修改标题, 否则您的邮件可能会被收信规则屏蔽%0d%0a%0d%0a--------------------%0d%0aTitle: JS原生实现HTML元素截图%0d%0aUrl: http://blog.uremy.world/2018/11/js-html-screenshot/index.html%0d%0a"><span>Email</span></a><a class="subscribe-link" href="/about"><span>About</span></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">JS原生实现HTML元素截图</p></h2><div class="post-date"><time datetime="2018-11-08T12:28:07.000Z">2018-11-08</time></div><div class="post-toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsFiddle-%E6%BC%94%E7%A4%BA"><span class="toc-number">1.</span> <span class="toc-text">JsFiddle 演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML"><span class="toc-number">2.1.</span> <span class="toc-text">HTML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSS"><span class="toc-number">2.2.</span> <span class="toc-text">CSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JavaScript"><span class="toc-number">2.3.</span> <span class="toc-text">JavaScript</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">3.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.1.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="post-content"><h3 id="JsFiddle-演示"><a href="#JsFiddle-演示" class="headerlink" title="JsFiddle 演示"></a>JsFiddle 演示</h3><blockquote>
<p><a href="http://jsfiddle.net/kiripa/zm4y5bjL/51">http://jsfiddle.net/kiripa/zm4y5bjL/51</a></p>
</blockquote>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h4 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      红色边框的就是canvas</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      偶数行的文本是蓝色，</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      是因为截图的时候另外附加了样式</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      可以在JS代码中查看附加样式的代码</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      在canvas上右键可以保存或者复制图片</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      如果觉得canvas太大了</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      通过CSS设定canvas长宽，这样不会影响生成的图片</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">white-space</span>:nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">canvas</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> red solid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>HTML和CSS的代码主要是实现一个带有横竖滚动条的容器元素，容器里面的元素就是要截图的内容，以及一个用来生成截图的canvas。</li>
</ul>
<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tag = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&quot;container&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> width = tag.scrollWidth;</span><br><span class="line"><span class="keyword">const</span> height = tag.scrollHeight;</span><br><span class="line"><span class="keyword">const</span> data = <span class="string">`&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;<span class="subst">$&#123;width&#125;</span>&quot; height=&quot;<span class="subst">$&#123;height&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;foreignObject width=&quot;100%&quot; height=&quot;100%&quot; &gt;</span></span><br><span class="line"><span class="string">    &lt;div id=&quot;container&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span></span><br><span class="line"><span class="string">    	<span class="subst">$&#123;tag.innerHTML&#125;</span></span></span><br><span class="line"><span class="string">    	&lt;style&gt;#container div:nth-child(even) &#123;color: #0098ff&#125;&lt;/style&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/foreignObject&gt;</span></span><br><span class="line"><span class="string">&lt;/svg&gt;`</span>;</span><br><span class="line">canvas.setAttribute(<span class="string">&quot;width&quot;</span>,width);</span><br><span class="line">canvas.setAttribute(<span class="string">&quot;height&quot;</span>,height);</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DOMURL = <span class="built_in">window</span>.URL || <span class="built_in">window</span>.webkitURL || <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> img = <span class="keyword">new</span> Image();</span><br><span class="line"><span class="keyword">const</span> svg = <span class="keyword">new</span> Blob([data], &#123;<span class="attr">type</span>: <span class="string">&#x27;image/svg+xml;charset=utf-8&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> url = DOMURL.createObjectURL(svg);</span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  DOMURL.revokeObjectURL(url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img.src = url;</span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li><p>js部分首先获取容器元素以及canvas，获取容器滚动条的高度以及宽度(即内容的完整宽高)，并且设置canvas的宽高为滚动条宽高。</p>
</li>
<li><p>接下来构建一个svg对象，这里是重点了，使用svg的<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/foreignObject">foreignObject</a>元素包裹要生成截图的HTML元素，也就是容器元素里的子元素，通过<code>tag.innerHTML</code>获取容器元素tag的所有子元素，然后拼接在svg的foreignObject元素中，如果子元素有非内联样式的话，需要在foreignObject中写一个style标签，将用到的样式也写进去，然后通过<code>new Blob([data], &#123;type: &#39;image/svg+xml;charset=utf-8&#39;&#125;);</code>创建一个Blob对象。</p>
</li>
<li><p>创建好blob对象后，通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL">createObjectURL</a>方法从blob对象创建一个url，然后new一个img对象，为img对象绑定onload事件，再将url设置到img对象的src属性。</p>
</li>
<li><p>当img对象加载完成后触发onload事件，然后将img对象绘制到canvas上,然后释放URL对象即可。</p>
</li>
</ul>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ul>
<li>最后在生成截图的canvas上右键可以保存或者复制截图，生成截图后canvas的width和height属性都是截图的宽高，如果你觉得太大了，不要直接修改width和height属性，会影响生成的图片，请通过CSS样式修改canvas的宽高，这样不会影响生成的图片。</li>
<li>容器内的子元素最好全部闭合，因为svg中貌似使用的是XHTML，语法与HTML基本一致但是更加严格，可能会导致无法生成截图，不过我也没有验证过，仅仅是我的猜想。</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL">MDN URL.createObjectURL()</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/foreignObject">MDN SVG &lt;foreignObject&gt;</a>  </p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/kgysf/hexo-theme-axianyu">Axianyu</a> , Powered By Hexo.</div></div></body></html>